<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="description" content="My work and contact info">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Img2Ascii</title>
  <link rel="stylesheet" href="standard.css">

</head>

<body>
  <!-- row of buttons -->
  <div class="controls">
    <button id="sizeBtn">Medium</button>
    <button id="colorBtn" disabled>Monochrome</button>
    <input type="file" id="imageInput" hidden accept="image/*">
    <button id="uploadBtn">Upload</button>
    <button id="saveBtn" disabled>Save</button>
  </div>

  <!-- image drop/ascii display -->
  <div id="dropbox">
    <p>Drop image here</p>
    <pre id="asciiOutput"></pre>
  </div>

  <!-- footer -->
  <p class="footer">Github link<br>Powered by XYZ</p>
</body>

<script>
let currentSize = 2; // 1=Small, 2=Medium, 3=Large
let isColor = false;

const sizeBtn = document.getElementById("sizeBtn");
const colorBtn = document.getElementById("colorBtn");
const uploadBtn = document.getElementById("uploadBtn");
const saveBtn = document.getElementById("saveBtn");
const dropbox = document.getElementById("dropbox");
const imageInput = document.getElementById("imageInput");

// size toggle
sizeBtn.addEventListener("click", () => {
  currentSize = currentSize === 3 ? 1 : currentSize + 1;
  const sizes = ["Small", "Medium", "Large"];
  sizeBtn.textContent = sizes[currentSize - 1];
});

// upload button, triggers hidden file input)
uploadBtn.addEventListener("click", () => imageInput.click());

// drag and drop
dropbox.addEventListener("dragover", (e) => {
  e.preventDefault();
  dropbox.classList.add("dragover");
});

dropbox.addEventListener("dragleave", () => {
  dropbox.classList.remove("dragover");
});

dropbox.addEventListener("drop", (e) => {
  e.preventDefault();
  dropbox.classList.remove("dragover");
  const file = e.dataTransfer.files[0];
  if (file && file.type.startsWith("image/")) {
    handleFile(file);
  }
});

// file input handler
imageInput.addEventListener("change", (e) => {
  const file = e.target.files[0];
  if (file) handleFile(file);
});

async function handleFile(file) {
  const formData = new FormData();
  formData.append("file", file);
  formData.append("size", currentSize);

  try {
    const response = await fetch("/upload", {
      method: "POST",
      body: formData,
    });
    const data = await response.json();
    if (data.error) throw new Error(data.error);
    
    document.getElementById("asciiOutput").textContent = data.ascii;
    saveBtn.disabled = false;
  } catch (error) {
    alert(error.message);
  }
}
</script>